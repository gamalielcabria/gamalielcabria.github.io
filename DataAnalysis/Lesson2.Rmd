---
title: "Introduction to the tidyverse"
author: "Gamaliel Cabria"
date: "`r Sys.Date()`"
output: html_document
---

# Introduction

The **tidyverse** is a collection of R packages designed for data science. All tidyverse packages share an underlying design philosophy, grammar, and data structures.

This loads several core packages:

- **ggplot2** (data visualization)
- **dplyr** (data manipulation)
- **tidyr** (tidy data formatting)
- **readr** (reading rectangular data)
- **purrr** (functional programming tools)
- **tibble** (modern data frames)

![dplyr](https://dplyr.tidyverse.org/logo.png){width=200px height=200px}![ggplot2](https://ggplot2.tidyverse.org/logo.png){width=200px height=200px}![tidyr](https://tidyr.tidyverse.org/logo.png){width=200px height=200px}
![readr](https://readr.tidyverse.org/logo.png){width=200px height=200px}![purrr](https://purrr.tidyverse.org/logo.png){width=200px height=200px}![tibble](https://tibble.tidyverse.org/logo.svg){width=200px height=200px}

## The Tidyverse Philosophy
The tidyverse promotes a consistent and intuitive approach to data analysis in R. It emphasizes:
- **Human readability**: Code is designed to be easy to read and understand.
- **Consistent syntax**: Functions across packages share similar naming conventions and arguments, reducing the learning curve.
- **Tidy data**: Data is structured in a way that makes it easy to manipulate and visualize.
- **Shared Grammar and Data Structures**: Many tidyverse packages use the same data structures (like tibbles) and share a common grammar, making it easier to switch between them.
  - **Pipes (`%>%`)**: A way to chain commands together, making code more readable.
  - **Verbs**: Functions are often named after the action they perform, such as `filter()`, `select()`, and `mutate()`, making it clear what each function does.
  - **tibbles**: A modern take on data frames that provides better printing and subsetting behavior. More predictable behavior (e.g., no automatic type conversion).

Here's a simple example of how the tidyverse philosophy is applied in practice:
```{r, eval=FALSE}
mtcars %>%                          # Load the mtcars dataset and pipe
  as_tibble() %>%                   # Tibble package: convert it to a tibble for better printing 
  filter(mpg > 20) %>%              # dplyr package: filter rows where mpg is greater than 20 
  mutate(kpl = mpg * 0.425144) %>%  # dplyr package: create a new column kpl (km per liter)
  ggplot(aes(x = wt, y = kpl)) +    # ggplot2 package: Create a ggplot using previous lines as input
  geom_point()                      # ggplot2 package: add points to the plot
```

## Installation
To use the tidyverse, you first need to install it. You can do this from CRAN using the following command:
```r
install.packages("tidyverse")
```

To use the tidyverse, we load the main package:
```{r}
library(tidyverse)
```

{:.note}
>This is the basic is also the basic way to install and load packages in R. 

# Data Manipulation with `dplyr`
`dplyr` is a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges. It uses vectorized operations to make data manipulation fast and efficient.
The main verbs in `dplyr` are:
- **`select()`**: Choose specific columns from a data frame.
- **`filter()`**: Subset rows based on conditions.
- **`mutate()`**: Create new variables or modify existing ones.
- **`summarise()`**: Reduce data to summary statistics.
- **`group_by()`**: Group data by one or more variables for subsequent operations.

## Example Dataset
We will use the built-in `mtcars` dataset for demonstration. The `mtcars` dataset contains specifications and performance measurements of various car models from the 1970s. It includes variables such as miles per gallon (mpg), number of cylinders (cyl), horsepower (hp), weight (wt), and more.
```{r, echo=TRUE, warning=FALSE, message=FALSE}
head(mtcars)
```

The `mtcars` dataset is a data frame with 32 rows and 11 columns, where each row represents a different car model and each column represents a different attribute of the car.

## Select columns
If we need to subset the dataset to only include specific columns, we can use the `select()` function from `dplyr`. This is useful for focusing on relevant variables for analysis.
```{r, echo=TRUE, warning=FALSE, message=FALSE}
mtcars %>% select(mpg, cyl, hp) %>% head()
mtcars %>% select(c(mpg, cyl, hp)) %>% head()
```

{:.notice}
> The input for `select()` can be a vector of column names. You can use the `c()` function to combine multiple column names, or list them directly within `select()`.
> 
> Additionally, you can use helper functions like `starts_with()`, `ends_with()`, `contains()`, etc. More of this later.

## Filter rows
Now, the power of `dplyr` shines with the `filter()` function, which allows us to subset rows based on conditions. This is particularly useful for focusing on specific groups or values within the dataset.
```{r, echo=TRUE, warning=FALSE, message=FALSE}
mtcars %>% filter(cyl > 5) %>% head()
```

Additionally, we can combine multiple conditions using logical operators like `&` (and) and `|` (or):
```{r, echo=TRUE, warning=FALSE, message=FALSE}
mtcars %>% filter(cyl > 5 & hp > 100) %>% head()
```

We can combine `filter` command with pattern matching such as `grepl()` or `str_detect()` from the `stringr` package.
```{r, echo=TRUE, warning=FALSE, message=FALSE}
# filter rows that is the model name contains "Mazda"
mtcars %>% filter(grepl("Mazda", rownames(mtcars)))

# You can also filter by removing rows that match a pattern. 
# Let us remove cars with the make "Hornet"
mtcars %>% filter(!grepl("Hornet", rownames(mtcars)))
```

## Bioinformatics Example
Let us use a Bioinformatics example to illustrate the use of `dplyr` for data manipulation.

For the next segment of this lesson, let us use 

### Create new variables
```r
mtcars %>% mutate(kpl = mpg * 0.425144)
```

### Summarize data
```r
mtcars %>% summarise(mean_mpg = mean(mpg), max_hp = max(hp))
```

### Group and summarize
```r
mtcars %>% 
  group_by(cyl) %>% 
  summarise(mean_mpg = mean(mpg), .groups = 'drop')
```

# Tidying Data with `tidyr`

### Gather (wide to long)
```r
pivot_longer(mtcars, cols = c(mpg, hp), names_to = "metric", values_to = "value") %>% head()
```

### Spread (long to wide)
```r
mtcars_long <- mtcars %>% 
  select(model = rownames(mtcars), cyl, gear) %>% 
  pivot_wider(names_from = gear, values_from = cyl, values_fn = mean)
```

# Data Visualization with `ggplot2`

### Basic scatter plot
```r
ggplot(mtcars, aes(x = wt, y = mpg)) + 
  geom_point()
```

### Add trend line
```r
ggplot(mtcars, aes(x = wt, y = mpg)) + 
  geom_point() + 
  geom_smooth(method = "lm")
```

# Conclusion
The tidyverse streamlines many common data science tasks in R. It emphasizes readability and consistency, making it ideal for beginners and experienced users alike.
